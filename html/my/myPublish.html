<!DOCTYPE html>
<html manifest="../pinba.appcache">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width" />
<link rel="stylesheet" href="../css/jquery.mobile-1.4.5.css" />
<script src="../js/jquery-1.11.3.js"></script>
<script src="../js/jquery.mobile-1.4.5.js"></script>
<script type="text/javascript" src="../myjs/myswipe.js"></script>
<script src="../myjs/mycommon.js"></script>


<style>
</style>

<script type="text/javascript">
	$(document).ready(function() {
		getWorkList();
	});
	function swipeRight() {
		closeSubPage();
	}
	function openWorkDetail(obj) {
		var workId = $(obj).attr('workId');
		changeSubPage('workDetail', 'myPubPage', 'workId=' + workId);
	}
    function pageInit(){
    	getWorkList();
    }
    //进入简历列表页面
    function openResumeInWork(obj){
    	var workId = $(obj).attr('workId');
        changeSubPage('resumeListInWork', 'myPubPage', 'workId=' + workId);
    }
	function getWorkList() {
		$('#workListUL').html('');
		var workInfo = {};
		var cachedUserInfo = getLoginUserInfo();
		if (cachedUserInfo != null) {
			workInfo.userId = cachedUserInfo.userId;
			workInfo.userToken = cachedUserInfo.userToken;
			workInfo.page = '1';
			workInfo.workType = 'partTime,fullTime';//兼职/全职招聘

			ajaxReq(
					'workAction',
					{
						method : 'getWorkList',
						workInfo : json2Str(workInfo)
					},
					function(data) {
						if (data.flag != 'fail') {
							var lihtmls = '';
							var litemplate = '<li><a onclick="openWorkDetail(this)" workId="+workId+"><h3>+workName+</h3><p>+workType+</p><p>发布时间:+effDate+&nbsp;|&nbsp;失效时间:+expDate+</p><p>关注数:+focusNumber+&nbsp;|&nbsp;查看数:+lookNumber+&nbsp;|&nbsp;收到简历数:+resumeNumber+</p></a>';
							litemplate += '<a href="#" onclick="openResumeInWork(this)" workId="+workId+">查看收到的简历</a></li>';
							for ( var i = 0; data.length > i; i++) {
								var workObj = data[i];
								var lihtml = litemplate.replace(/\+workId\+/g,
										workObj.workId).replace('+workName+',
										workObj.workName).replace('+workType+',
												getDisplayEnumValue('workType',workObj.workType)).replace('+effDate+',
										workObj.effDate).replace('+expDate+',
										workObj.expDate).replace(
										'+focusNumber+', workObj.focusNumber)
										.replace('+lookNumber+',
												workObj.lookNumber).replace(
												'+resumeNumber+',
												workObj.resumeNumber);
								lihtmls += lihtml;
							}
							$('#workListUL').append(lihtmls);
							$('#workListUL').listview("refresh");
						} else {
							alert(data.msg);
						}
					});
		}
	}
	
	//向下滑动刷新
	function swipeDown(){
		getWorkList();
	}
</script>
</head>
<body>
	<div data-role="page" id="myPubPage">
		<div data-role="header" data-position="fixed" data-fullscreen="false">
			<!-- 返回按钮 -->
			<a href="#" data-rel="back"
				class="ui-btn ui-btn-left ui-alt-icon ui-nodisc-icon ui-corner-all ui-btn-icon-notext ui-icon-carat-l"
				onclick="closeSubPage();return false;">Back</a>

			<h1>我的招聘</h1>
		</div>

		<div id="workList">
			<div style="width:100%;height:0;background:#98bf21;text-align:center;" id="pullDownRefreshDiv">下拉刷新</div>
			<ul data-role="listview" id="workListUL" data-split-icon="gear">
				<li data-icon="false"><a onclick="openWork(this)" workId="1"
					style="padding-top: 0px; padding-bottom: 0px;"> <img
						src="http://image.zhangxinxu.com/image/study/s/s128/mm5.jpg">
						<h2>臻洪</h2> <!-- 用人单位-->
						<p>临时工</p> <!-- 兼职名称 -->
						<p>2015-8-1</p> <!-- 兼职名称 -->
				</a></li>

				<li data-icon="false"><a onclick="openWork(this)" workId="12"
					style="padding-top: 0px; padding-bottom: 0px;"> <img
						src="http://image.zhangxinxu.com/image/study/s/s128/mm5.jpg">
						<h2>臻洪</h2> <!-- 用人单位-->
						<p>临时工</p> <!-- 兼职名称 -->
						<p>2015-8-1</p> <!-- 兼职名称 -->
				</a></li>
			</ul>
			
			<a data-role="button" data-mini="true" data-icon="plus"
                    onclick="changeSubPage('work', 'myPubPage')">发布招聘信息</a>
		</div>
	</div>
</body>
</html>