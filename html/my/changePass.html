<!DOCTYPE html>
<html manifest="../pinba.appcache">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width" />
<script src="../js/jquery-1.11.3.js"></script>
<link rel="stylesheet" href="../css/jquery.mobile-1.4.5.css" />
<script src="../js/jquery-1.11.3.js"></script>
<script src="../js/jquery.mobile-1.4.5.js"></script>
<script type="text/javascript" src="../myjs/mycommon.js"></script>
<script type="text/javascript" src="../myjs/myswipe.js"></script>
<style>
.controlgroup-textinput {
	    padding-top: .22em;
	    padding-bottom: .22em;
}
</style>

<script type="text/javascript">
	function swipeRight() {
		closeSubPage();
	}

	function changePass() {
		var userId = 0;
		var verifyCode = $('#msgverifyCode').val();
		var newPassword = $('#password').val();
		
		var userInfo = {};
		userInfo.userId = userId;
		userInfo.msgverifyCode = verifyCode;
		userInfo.newPassword = newPassword;

		//调用验证码短信发送接口
		ajaxReq('userAction', {
			method : 'changePass',
			userInfo : json2Str(userInfo)
		}, function(data) {
			if (data.flag == 'success') {
				alert(data.msg);
				closeSubPage();
			 } else {
				alert(data.msg);
			}
		});
	}
	
	var clock = '';
	function sendTelVerifyCode(obj){
		var phoneNoInputId = $(obj).attr('for');
		if ($('#'+phoneNoInputId).val()==''){
			alert('手机号不能为空!');
			return;
		}
		var userInfo = {};
		userInfo.cellphone = $('#ptel').val();
		//调用验证码短信发送接口
		ajaxReq('commonAction', {
			method : 'sendVerifyCode',
			userInfo : json2Str(userInfo)
		}, function(data) {
			if (data.flag == 'success') { */
				clock=setInterval('clockDecre("'+obj.id+'")',1000);
			/* } else {
				alert(data.msg);
			}
		});
	}
	var times = 60;//验证码发送按钮点击后的倒数时间,单位秒
	function clockDecre(btnId)
	{
		times = times -1 ;
	    $('#'+btnId).html(times);
	    if (times==0){
	    	$('#'+btnId).html('重新发送验证码');
	    	clearInterval(clock);
	    }
	}
</script>
</head>
<body>
	<div id="messagePage" data-role="page">
		<div data-role="header" id="header">

			<a href="#" data-rel="back"
				class="ui-btn ui-btn-left ui-alt-icon ui-nodisc-icon ui-corner-all ui-btn-icon-notext ui-icon-carat-l"
				onclick="closeSubPage();return false;">Back</a>
			<h1>修改密码</h1>


		</div>
		<div data-role="content">
			
			<form onsubmit="reutrn changePass()">
				<label for="tel">手机号码:</label>
				<div style="display: inline-flex; width: 100%">
					<div style="width: 70%; height: 100%;">
						<input type="tel" name="tel" id="tel" value="" required="required" disabled
							pattern="[0-9]{11}" title="11位手机号码"
							placeholder="可用于登陆，一个号码只能注册一次。">
					</div>
					<a data-mini="true" onclick="sendTelVerifyCode(this)"
						class="ui-btn" id="sendVerifyBtn" for="tel"
						style="width: 30%; height: 100%; margin-top: 8px;">发送验证码</a>
				</div>

				<label for="msgverifyCode">短信验证码:</label> <input type="text"
					name="msgverifyCode" id="msgverifyCode" value=""
					required="required" placeholder="输入你手机上收到的6位数字。">
					
				 <label
						for="ppassword">新密码:</label> <input type="password"
						name="ppassword" id="ppassword" value="" autocomplete="off"
						required="required" placeholder="最短6位，最长10位，只可包含数字字母"
						pattern="[A-Za-z0-9]{6,10}" title="最短6位，最长10位，只可包含数字字母">

				<button type="submit" class="ui-btn">修改密码</button>
			</form>
		</div>
	</div>
</body>
</html>