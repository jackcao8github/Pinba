<!DOCTYPE html>
<html manifest="../pinba.appcache">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1, user-scalable=no" />

<script src="../js/jquery-1.11.3.min.js"></script>
<link rel="stylesheet" href="../css/font-awesome.min.css" /><link rel="stylesheet" href="../css/bootstrap.min.css" />
</head>
<body>
	<div id="resumePage" data-role="page">
		<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
			<div class="navbar-header">
				<a class="navbar-brand" href="#"
					onclick="closeSubPage();return false;"><i
					class="fa fa-close fa-lg"></i></a> <a class="navbar-brand">增加求职简历</a>
			</div>
		</nav>
		<div data-role="content" class="ui-mini">
			<div id="form">
				<div class="form-group">
					<label for="resumeName">简历名称:</label> <input type="text" class="form-control"
						name="resumeName" id="resumeName" value="" required>
				</div>

				<div class="form-group">
					<label for="resumeType" class="select">简历类型:</label> <select class="form-control"
						name="resumeType" id="resumeType" >
					</select>
				</div>

				<div class="form-group">
					<label for="realName">真实姓名:</label> <input type="text" class="form-control"
						name="realName" id="realName" value="" required>
				</div>
				<div class="form-group">
					<label for="IDNO">身份证:</label> <input type="text" class="form-control"
						name="IDNO" id="IDNO" value="" required>
				</div>
				<div class="form-group">
					<label for="stature">身高(CM):</label> <input type="text" class="form-control"
						name="stature" id="stature" value="" required pattern="[0-9]{3}" placeholder="身高">
				</div>
				<div class="form-group">
					<label for="cellphone">联系手机:</label> <input type="text" class="form-control"
						name="cellphone" id="cellphone" value="" required pattern="[0-9]{11}">
				</div>
				<div class="form-group">
					<label for="email">联系邮箱:</label> <input type="email" name="email"
						id="email" value="" required>
				</div>
				<div class="form-group">
					<label for="sex" class="select">性别:</label> <select class="form-control" name="sex"
						id="sex" >
						<option value="male" selected>男</option>
						<option value="female">女</option>
					</select>
				</div>
				<div class="form-group">
					<label for="age">年龄:</label> <input type="text" class="form-control" name="age" id="age"
						value="" required>
				</div>

				<div class="form-group">
					<label for="expectPost" class="select">期望职位:</label> <select class="form-control"
						name="expectPost" multiple="multiple" id="expectPost"
						>
					</select>
				</div>
				<div class="form-group">
					<label for="expectWorkArea" class="select">期望区域:</label> <select class="form-control"
						name="expectWorkArea" multiple="multiple" id="expectWorkArea"
						>
					</select>
				</div>
				<fieldset data-role="controlgroup" data-type="horizontal">
                    <legend>薪资</legend>
                    <input type="radio" name="sallaryType" id="hour" value="hour"
                        checked="checked"> <label for="hour">小时</label><input
                        type="radio" name="sallaryType" id="day" value="day"> <label
                        for="day">天</label>
                </fieldset>
                <div data-role="fieldcontain" id="daySallaryDiv">
                    <input type="range" name="sallaryValue" id="sallaryValue"
                        value="10" min="0" max="200">
                </div>

				<div class="form-group">
					<label for="dayCharge">期望工资当天结算:</label> <select class="form-control" name="dayCharge"
						id="dayCharge" >
						<option value="no">No</option>
						<option value="yes" selected="">Yes</option>
					</select>
				</div>
				<div class="form-group">
					<label for=foodAndLodging>期望提供食宿:</label><select class="form-control"
						name="foodAndLodging" id="foodAndLodging" >
						<option value="no">No</option>
						<option value="yes" selected="">Yes</option>
					</select>
				</div>


				<div class="form-group">
					<label for="degree" class="select">学历:</label> <select class="form-control"
						name="degree" id="degree" >
						<option value="gaozhong" selected>高中</option>
						<option value="bengke">本科</option>
						<option value="suoshi">硕士</option>
					</select>
				</div>
				<div class="form-group">
					<label for="experience" class="select">工作经验(年):</label> <input
						type="text" class="form-control" name="experience" id="experience" value="0"
						required placeholder="工作经验(年)" pattern="[0-9]{1,2}"
						title="必须是整数">
				</div>

				<div class="form-group">
					<label for="workHisList">工作经历:</label>
					<textarea class="form-control"cols="40" rows="8" name="workHisList" id="workHisList"
						required placeholder="让用人单位更好了解你" data-mini="true"></textarea>
				</div>
				<div class="form-group">
					<label for="eduHisList">教育经历:</label>
					<textarea class="form-control"cols="40" rows="8" name="eduHisList" id="eduHisList"
						required placeholder="让用人单位更好了解你" data-mini="true"></textarea>
				</div>

				<div class="form-group">
					<label for="selfReview">自我评价:</label>
					<textarea class="form-control"cols="40" rows="8" name="selfReview" id="selfReview"
						required placeholder="让用人单位更好了解你" data-mini="true"></textarea>
				</div>

				<div class="form-group">
					<label for="verifyCode">验证码:</label>
					<fieldset class="ui-grid-a">
						<div class="ui-block-a">
							<input type="text" class="form-control" name="verifyCode" id="verifyCode" value=""
								placeholder="验证码" required>
						</div>
						<div class="ui-block-b">
							<img id="verifyImg" src=""
								style="margin-top: 14px; margin-left: 5px;"></img>
						</div>
					</fieldset>
					<!-- <div style="display: inline-flex; width: 100%">
						<div style="width: 40%; height: 100%;">
							<input type="text" class="form-control" name="verifyCode" id="verifyCode" value=""
								placeholder="验证码" required>
						</div>
						<a data-mini="true" href="#"
							style="width: 30%; height: 100%; margin-top: 15px;margin-left:-80px;"><img
							id="verifyImg" src=""></img></a>
					</div> -->
				</div>

				<a role="button" class="btn btn-success btn-lg btn-block" onclick="publish()"  >提交</a>
			</div>
		</div>
	</div>
</body>


<script type="text/javascript" src="../myjs/mycommon.js"></script>
<script type="text/javascript" src="../myjs/myswipe.js"></script>

<script type="text/javascript">
	var resumeId = 0;
	$(document).ready(function() {
		pageInit();
	});
	function pageInit() {
		//加载验证码
		loadVerifyImage('verifyImg');
		//初始化下拉框控件
		$('select').each(function(index, item) {
			if (item.id == "expectWorkArea") {
				fillOptions(item.id, localStorage.city);
			} else {
				fillOptions(item.id);
			}
		});

		resumeId = getQueryString('resumeId');
		if (resumeId > 0) {
			$('#title').html('修改简历');
			var resumeInfo = {};
			if (resumeId > 0) {
				resumeInfo.resumeId = resumeId;
			}
			var cachedUserInfo = getLoginUserInfo();
			if (cachedUserInfo != null) {
				resumeInfo.userToken = cachedUserInfo.userToken;

				ajaxReq('resumeAction', {
					method : 'getResumeInfo',
					resumeInfo : json2Str(resumeInfo)
				}, function(data) {
					if (data.flag == 'success') {
						bindData(data);
					} else {
						showTipDialog(data.msg);
						return false;
					}
				});
			}
		}
	}
	//绑定数据到控件
	function bindData(jsonData) {
		for ( var o in jsonData) {
			var value = jsonData[o];

			if (o == 'sallaryType') {
				if (value == 'day') {
					showDaySallary();
				} else {
					showHourSallary();
				}
				continue;
			}
			var ctrl = $('#' + o);
			if (ctrl.length > 0) {
				if (ctrl[0].id == 'expectWorkArea') {
					selectOptions(o, value, localStorage.city);//根据城市加载行政区域
				} else if (ctrl[0].tagName == 'SELECT') {//jquery mobile 渲染了select,html完全变了
					selectOptions(o, value);
				} else if (o == 'selfReview') {
					ctrl.html(value);
				} else {
					ctrl.val(value);
				}
			}
		}
	}
	function swipeRight() {
		closeSubPage();
	}

	function publish() {
		//form表单校验不通过
		if (checkFormNullable('form') == false) {
			return;
		}
		var resumeInfo = {};
		var method = 'newResume';
		if (resumeId > 0) {
			resumeInfo.resumeId = resumeId;
			method = 'modResume';
		}
		var cachedUserInfo = getLoginUserInfo();
		if (cachedUserInfo != null) {
			resumeInfo.userId = cachedUserInfo.userId;
			resumeInfo.resumeName = $('#resumeName').val();
			resumeInfo.realName = $('#realName').val();
			resumeInfo.sex = $('#sex').val();
			resumeInfo.age = $('#age').val();
			resumeInfo.resumeType = $('#resumeType').val();
			resumeInfo.expectIndustry = $('#expectIndustry').val();

			var expectPostStr = '';
			var postArr = $('#expectPost').val();
			$(postArr).each(function(inx, item) {
				if (expectPostStr != '') {
					expectPostStr += ',';
				}
				expectPostStr += item;
			});
			resumeInfo.expectPost = expectPostStr;

			var expectWorkAreaStr = '';
			var areaArr = $('#expectWorkArea').val();
			$(areaArr).each(function(ind, item) {
				if (expectWorkAreaStr != '') {
					expectWorkAreaStr += ',';
				}
				expectWorkAreaStr += item;
			});
			resumeInfo.expectWorkArea = expectWorkAreaStr;
			resumeInfo.dayCharge = $('#dayCharge').val();
			resumeInfo.foodAndLodging = $('#foodAndLodging').val();
			resumeInfo.expectIndustry = $('#expectIndustry').val();
			resumeInfo.degree = $('#degree').val();
			resumeInfo.experience = $('#experience').val();
			resumeInfo.selfReview = $('#selfReview').val();
			resumeInfo.cellphone = $('#cellphone').val();
			resumeInfo.email = $('#email').val();
			resumeInfo.verifyCode = $('#verifyCode').val();
			resumeInfo.eduHisList = $('#eduHisList').val();
			resumeInfo.workHisList = $('#workHisList').val();
			resumeInfo.sallaryValue = $('#sallaryValue').val();
			resumeInfo.sallaryType = $('[name="sallaryType"]:checked').val();
			resumeInfo.IDNO = $('#IDNO').val();//身份证号
			resumeInfo.stature = $('#stature').val();//身高
			
			ajaxReq('resumeAction', {
				method : method,
				resumeInfo : json2Str(resumeInfo)
			}, function(data) {
				if (data.flag == 'success') {
					showTipDialog(data.msg);
					closeSubPage();
				} else {
					showTipDialog(data.msg);
					return false;
				}
			});
		}
		return false;
	}

	function showHourSallary() {
		$('[name="sallaryType"][value="hour"]').eq(0).attr('checked', true);
		$('[for="hour"]').addClass('ui-btn-active');
		$('[for="day"]').removeClass('ui-btn-active');
	}

	function showDaySallary() {
		$('[name="sallaryType"][value="day"]').eq(0).attr('checked', true);
		$('[for="day"]').addClass('ui-btn-active');
		$('[for="hour"]').removeClass('ui-btn-active');
	}
</script>
</html>