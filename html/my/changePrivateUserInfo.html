<!DOCTYPE html>
<html manifest="../pinba.appcache">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width" />
<link rel="stylesheet" href="../css/jquery.mobile-1.4.5.css" />
<script src="../js/jquery-1.11.3.js"></script>
<script src="../js/jquery.mobile-1.4.5.js"></script>
<script type="text/javascript" src="../myjs/mycommon.js"></script>
<script type="text/javascript" src="../myjs/myswipe.js"></script>
<style>
</style>

<script type="text/javascript">
	var userId = 0;
	$(document).ready(function() {
		var cachedUserInfo = getLoginUserInfo();
		if (cachedUserInfo != null) {
			var userInfo = {};
			userId = cachedUserInfo.userId;
			userInfo.userId = cachedUserInfo.userId;
			ajaxReq('userAction', {
				method : 'getUserInfo',
				userInfo : json2Str(userInfo)
			}, function(data) {
				if (data.flag == 'success') {//登陆成功后返回主页面
					bindData(data);
				} else {
					alert(data.msg);
					return false;
				}
			});
		}
	});

	//绑定数据到控件
	function bindData(jsonData) {
		for ( var o in jsonData) {
			var value = jsonData[o];
			var ctrl = $('#' + o);
			if (ctrl.length > 0) {
				if (ctrl[0].tagName == 'SELECT') {//jquery mobile 渲染了select,html完全变了
					selectOptions(o, value);
				} else if (o == 'selfreview') {
					ctrl.html(value);
				} else {
					ctrl.val(value);
				}
			}
		}
	}
	function swipeRight() {
		closeSubPage();
	}

	function modPrivate() {
		var userInfo = {};
		userInfo.userName = $('#userName').val();
		userInfo.userId = userId;
		userInfo.email = $('#email').val();
		userInfo.sex = $('#sex').val();
		userInfo.age = $('#age').val();

		ajaxReq('userAction', {
			method : 'modUser',
			userInfo : json2Str(userInfo)
		}, function(data) {
			if (data.flag == 'success') {
				closeSubPage();
			} else {
				alert(data.msg);
				return false;
			}
		});
		return false;
	}

	var clock = '';
	function sendTelVerifyCode(obj) {
		var phoneNoInputId = $(obj).attr('for');
		if ($('#' + phoneNoInputId).val() == '') {
			alert('手机号不能为空!');
			return;
		}
		var userInfo = {};
		userInfo.cellphone = $('#ptel').val();
		//调用验证码短信发送接口
		ajaxReq('commonAction', {
			method : 'sendVerifyCode',
			userInfo : json2Str(userInfo)
		}, function(data) {
			if (data.flag == 'success') {
				times = 60;
				clock = setInterval('clockDecre("' + obj.id + '")', 1000);
			} else {
				alert(data.msg);
			}
		});
	}
	var times = 60;//验证码发送按钮点击后的倒数时间,单位秒
	function clockDecre(btnId) {
		times = times - 1;
		$('#' + btnId).html(times);
		if (times == 0) {
			$('#' + btnId).html('重新发送验证码');
			clearInterval(clock);
		}
	}
</script>
</head>
<body>
	<div id="regPage" data-role="page">
		<div data-role="header" id="header">

			<a href="#" data-rel="back"
				class="ui-btn ui-btn-left ui-alt-icon ui-nodisc-icon ui-corner-all ui-btn-icon-notext ui-icon-carat-l"
				onclick="closeSubPage();return false;">Back</a>
			<h1>修改用户信息</h1>

		</div>
		<div data-role="content" class="ui-mini">
			<form id="userInfoDiv" onsubmit="return modPrivate()">
				<div data-role="fieldcontain">
					<label for="userName">昵称:</label> <input type="text"
						name="userName" id="userName" value="" required="required"
						placeholder="用于显示，不用于登陆，可修改。">
				</div>

				<div data-role="fieldcontain">
					<label for="sex" class="select">性别:</label> <select name="sex"
						id="sex" data-native-menu="false">
						<option value="male" selected>男</option>
						<option value="female">女</option>
					</select>
				</div>
				<div data-role="fieldcontain">
					<label for="age">年龄:</label> <input type="text" name="age" id="age"
						value="" required="required">
				</div>
				<div data-role="fieldcontain">
					<label for="email">邮箱:</label> <input type="text" name="email"
						id="email" value="" required="required">
				</div>
				<button type="submit" class="ui-btn">提交</button>
			</form>

		</div>
	</div>
</body>
</html>