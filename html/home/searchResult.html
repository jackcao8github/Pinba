<!DOCTYPE html>
<html manifest="../pinba.appcache">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width" />
<link rel="stylesheet" href="../css/jquery.mobile-1.4.5.css" />
<script src="../js/jquery-1.11.3.js"></script>
<script src="../js/jquery.mobile-1.4.5.js"></script>
<script type="text/javascript" src="../myjs/myswipe.js"></script>
<script type="text/javascript" src="../myjs/mycommon.js"></script>

<style>

</style>

<script type="text/javascript">
function swipeRight(){
	closeSubPage();
}
var searchKey = '';
$(document).on("pageinit",function(event){
	searchKey = getQueryString('searchKey');
	 $('#workList').html('');
	   loadWorkList();
	});
	
	
var workPage = 1;
function swipeUp() {
   loadWorkList();
}
function loadWorkList() {
    $('#pullUpFreshText').html('加载中...');
    var workInfo = {};
    workInfo.page = workPage;
    workInfo.cityName = localStorage.city;
    workInfo.workType = 'partTime,fullTime';//兼职/全职招聘
    workInfo.workName = searchKey;

    ajaxReq('workAction', {
        method : 'getWorkList',
        workInfo : json2Str(workInfo)
    }, function(data) {
        if (data.flag != 'fail') {
            if (data.length > 0) {
                workPage++;
                fillWorkList(data);
            }
        } else {
            alert(data.msg);
        }
        
        $('#pullUpFreshText').html('加载完成');
        $('#pullUpFresh').slideUp('slow');
    });
}

function fillWorkList(data) {
    var newhtml = '<li data-icon="false" onclick="openWork(this)" workId="+workId+"><a href="#" class="ui-btn ui-mini">\
        <div style="overflow: hidden;">\
        <p style="float: left;font-weight:bold;">+title+</p>\
        <p style="color: black; float: right">+time+</p>\
        </div><div style="overflow: hidden;">\
                    <p style="float: left">+condition+</p>\
                    <p style="color: red; float: right">时薪:+daymoney+</p>\
                </div><div style="overflow: hidden;">\
                    <p style="float: left">+username+</p>\
                    <div style="float: right; color: #f63">+userCredit+\
                    </div></div></a></li>';

    for ( var i = 0; data.length > i; i++) {
        var workObj = data[i];
        var conditionStr = '';
        conditionStr += getDisplayEnumValue('expectDegree',
                workObj.expectDegree)
                + '学历';
        conditionStr += '&nbsp;|&nbsp;';
        conditionStr += getDisplayEnumValue('expectExperience',
                workObj.expectExperience)
                + '经验';
        conditionStr += '&nbsp;|&nbsp;';
        conditionStr += getDisplayEnumValue('expectAge', workObj.expectAge)
                + '年龄';

        var userCreditHtml = createCreditHtml(workObj.userCredit);

        var html = newhtml.replace('+username+', workObj.userName).replace(
                '+title+', workObj.workName).replace('+time+',
                workObj.effDate).replace('+condition+', conditionStr)
                .replace('+daymoney+', workObj.daySallary).replace(
                        '+workId+', workObj.workId).replace('+userCredit+',
                        userCreditHtml);

        $('#workList').append(html);
    }

    $('#workList').listview("refresh");
}

function createCreditHtml(userCredit) {
    var strArr = [];
    var mod = userCredit / 100;
    mod = parseInt(mod);
    var left = userCredit % 100;
    if (mod > 0) {
        for ( var i = 0; mod > i; i++) {
            strArr.push('<i class="fa fa-star"></i>');
        }
    }
    if (left > 50) {
        strArr.push('<i class="fa fa-star-o"></i>');
    }
    if (strArr.length != 5) {
        var c = 5 - strArr.length;
        for ( var j = 0; c > j; j++)
            strArr.push('<i class="fa fa-star-o"></i>');
    }

    return strArr.join('');
}
function openWork(obj) {
    var workid = $(obj).attr('workId');
    changeSubPage('workDetail', 'homePage', 'workid=' + workid);
}
</script>
</head>
<body>
	<div data-role="page" id="messagePage">
		<div data-role="header" data-position="fixed" data-fullscreen="false">
			<!-- 返回按钮 -->
			<a href="#" data-rel="back"
				class="ui-btn ui-btn-left ui-alt-icon ui-nodisc-icon ui-corner-all ui-btn-icon-notext ui-icon-carat-l" onclick="closeSubPage();return false;">Back</a>

			<h1>工作</h1>
		</div>
		<ul data-role="listview" id="workList">
                    <li data-icon="false" onclick="openWork(this)" workId="1"><a
                        href="#" class="ui-btn ui-mini">
                            <div style="overflow: hidden;">
                                <p style="float: left; font-weight: bold;">招聘营业员(江宁)</p>
                                <!--招聘标题-->
                                <p style="color: black; float: right">22:23 PM</p>
                            </div>
                            <div style="overflow: hidden;">
                                <p style="float: left">学历不限&nbsp;|&nbsp;经验不限&nbsp;|&nbsp;年龄不限</p>
                                <!--要求-->
                                <p style="color: red; float: right">日薪:100-200</p>
                                <!--待遇-->
                            </div>
                            <div style="overflow: hidden;">
                                <p style="float: left">KFC-欧尚超市店</p>
                                <!--招聘用户名称-->
                                <p style="float: right; color: #f63">
                                    <i class="fa fa-star"></i><i class="fa fa-star"></i><i
                                        class="fa fa-star"></i><i class="fa fa-star"></i><i
                                        class="fa fa-star-half-full"></i>
                                </p>
                            </div>
                    </a></li>
                    <li data-icon="false" onclick="openWork(this)" workId="1"><a
                        href="#" class="ui-btn ui-mini">
                            <div style="overflow: hidden;">
                                <p style="float: left; font-weight: bold;">招聘营业员(江宁)</p>
                                <!--招聘标题-->
                                <p style="color: black; float: right">22:23 PM</p>
                            </div>
                            <div style="overflow: hidden;">
                                <p style="float: left">学历不限&nbsp;|&nbsp;经验不限&nbsp;|&nbsp;年龄不限</p>
                                <!--要求-->
                                <p style="color: red; float: right">日薪:100-200</p>
                                <!--待遇-->
                            </div>
                            <div style="overflow: hidden;">
                                <p style="float: left">KFC-欧尚超市店</p>
                                <!--招聘用户名称-->
                                <p style="float: right; color: #f63">
                                    <i class="fa fa-star"></i><i class="fa fa-star"></i><i
                                        class="fa fa-star"></i><i class="fa fa-star"></i><i
                                        class="fa fa-star-half-full"></i>
                                </p>
                            </div>
                    </a></li>
                    <li data-icon="false" onclick="openWork(this)" workId="1"><a
                        href="#" class="ui-btn ui-mini">
                            <div style="overflow: hidden;">
                                <p style="float: left; font-weight: bold;">招聘营业员(江宁)</p>
                                <!--招聘标题-->
                                <p style="color: black; float: right">22:23 PM</p>
                            </div>
                            <div style="overflow: hidden;">
                                <p style="float: left">学历不限&nbsp;|&nbsp;经验不限&nbsp;|&nbsp;年龄不限</p>
                                <!--要求-->
                                <p style="color: red; float: right">日薪:100-200</p>
                                <!--待遇-->
                            </div>
                            <div style="overflow: hidden;">
                                <p style="float: left">KFC-欧尚超市店</p>
                                <!--招聘用户名称-->
                                <p style="float: right; color: #f63">
                                    <i class="fa fa-star"></i><i class="fa fa-star"></i><i
                                        class="fa fa-star"></i><i class="fa fa-star"></i><i
                                        class="fa fa-star-half-full"></i>
                                </p>
                            </div>
                    </a></li>
                    <li data-icon="false" onclick="openWork(this)" workId="1"><a
                        href="#" class="ui-btn ui-mini">
                            <div style="overflow: hidden;">
                                <p style="float: left; font-weight: bold;">招聘营业员(江宁)</p>
                                <!--招聘标题-->
                                <p style="color: black; float: right">22:23 PM</p>
                            </div>
                            <div style="overflow: hidden;">
                                <p style="float: left">学历不限&nbsp;|&nbsp;经验不限&nbsp;|&nbsp;年龄不限</p>
                                <!--要求-->
                                <p style="color: red; float: right">日薪:100-200</p>
                                <!--待遇-->
                            </div>
                            <div style="overflow: hidden;">
                                <p style="float: left">KFC-欧尚超市店</p>
                                <!--招聘用户名称-->
                                <p style="float: right; color: #f63">
                                    <i class="fa fa-star"></i><i class="fa fa-star"></i><i
                                        class="fa fa-star"></i><i class="fa fa-star"></i><i
                                        class="fa fa-star-half-full"></i>
                                </p>
                            </div>
                    </a></li>
                    <li data-icon="false" onclick="openWork(this)" workId="1"><a
                        href="#" class="ui-btn ui-mini">
                            <div style="overflow: hidden;">
                                <p style="float: left; font-weight: bold;">招聘营业员(江宁)</p>
                                <!--招聘标题-->
                                <p style="color: black; float: right">22:23 PM</p>
                            </div>
                            <div style="overflow: hidden;">
                                <p style="float: left">学历不限&nbsp;|&nbsp;经验不限&nbsp;|&nbsp;年龄不限</p>
                                <!--要求-->
                                <p style="color: red; float: right">日薪:100-200</p>
                                <!--待遇-->
                            </div>
                            <div style="overflow: hidden;">
                                <p style="float: left">KFC-欧尚超市店</p>
                                <!--招聘用户名称-->
                                <p style="float: right; color: #f63">
                                    <i class="fa fa-star"></i><i class="fa fa-star"></i><i
                                        class="fa fa-star"></i><i class="fa fa-star"></i><i
                                        class="fa fa-star-half-full"></i>
                                </p>
                            </div>
                    </a></li>
                </ul>
                <div style="width:100%;height:0;background-color:#3388cc;position:relative;top:0;left:0" id="pullUpFresh"><div style="color:white;text-align:center;line-height:50px;height:50px;width:100%;position:absolute;top:0;left:0" id="pullUpFreshText">上拉刷新</div></div>

	</div>
</body>
</html>
