<!DOCTYPE html>
<html manifest="../pinba.appcache">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width" />

<link rel="stylesheet" href="../css/jquery.mobile-1.4.5.css" />
<link rel="stylesheet" href="../mycss/photoswipe.css" />
<link rel="stylesheet" href="../css/font-awesome.css" />
<link rel="stylesheet" href="../mycss/scrolltotop.css" />

<script src="../js/jquery-1.7.1.min.js"></script>
<!-- 支持jquery.event.drag-1.5.min.js中的图片手动滑动 -->
<script src="../js/jquery.mobile-1.4.5.js"></script>
<script type="text/javascript" src="../js/jquery.event.drag-1.5.min.js"></script>
<script type="text/javascript" src="../js/jquery.touchSlider.js"></script>
<script type="text/javascript" src="../myjs/myswipe.js"></script>
<script type="text/javascript" src="../myjs/mycommon.js"></script>


<script type="text/javascript">
	$(document).ready(
			function() {
				$('.location').click(function() {
					$('html,body').animate({
						scrollTop : '0px'
					}, 800);
				});
				//searchBox绑定点击事件
				$('#searchBox').bind('click', function() {
					//$.mobile.changePage("search.html", "pop", false, false);
					changeSubPage('search', 'homePage');
				});
				//图片滚动处理 ------------------------------start
				$(".main_visual").hover(function() {

				}, function() {

				});
				$dragBln = false;

				$(".main_image").touchSlider(
						{
							flexible : true,
							speed : 200,
							btn_prev : $("#btn_prev"),
							btn_next : $("#btn_next"),
							paging : $(".flicking_con a"),
							counter : function(e) {
								$(".flicking_con a").removeClass("on").eq(
										e.current - 1).addClass("on");
							}
						});

				$(".main_image").bind("mousedown", function() {
					$dragBln = false;
				});

				$(".main_image").bind("dragstart", function(e) {
					$dragBln = true;
					e.preventDefault();
				});

				$(".main_image a").click(function() {
					if ($dragBln) {
						return false;
					}
				});

				timer = setInterval(function() {
					$("#btn_next").click();
				}, 5000);

				$(".main_visual").hover(function() {
					clearInterval(timer);
				}, function() {
					timer = setInterval(function() {
						$("#btn_next").click();
					}, 5000);
				});

				$(".main_image").bind("touchstart", function() {
					clearInterval(timer);
				}).bind("touchend", function() {
					timer = setInterval(function() {
						$("#btn_next").click();
					}, 5000);
				});
				//图片滚动处理 ------------------------------end

				//定位
				getPosition(showPosition);

				//阻止在图片上滑动时引起的翻页行为
				$(".main_visual").bind(touchEvents.touchend, function() {
					return false;
				}, false);
				$(".main_visual").bind(touchEvents.toucancel, function() {
					return false;
				}, false);
			    $('#workList').html('');
			    $('#reqworkList').html('');
				loadWorkList();
			});

	/* 显示当前定位城市 */
	function showPosition() {
		if (localStorage.qryCity != null) {
			$("#location").html(localStorage.qryCity);
		} else {
			$("#location").html(localStorage.city);
		}
		
		//上传用户当前坐标
        if (localStorage.latitude!=null){
        	var cachedUserInfo = str2Json(localStorage.userInfo);
            if (cachedUserInfo != null) {
              userInfo = {};
                userInfo.userId = cachedUserInfo.userId;
                userInfo.latitude = localStorage.latitude;
                userInfo.longitude = localStorage.longitude;
                userInfo.cityName = localStorage.city;
                
                ajaxReq('userAction', {
                    method : 'logUserPosition',
                    userInfo : json2Str(userInfo)
                }, function(data) {
                    if (data.flag == 'success') {//登陆成功后返回主页面
                    } else {
                    }
                });
            }
        }
	}

	function swipeLeft() {
		//打开当前页面左边页面
		parent.switchIframeByClick('faxian');
	}

	function swipeRight() {
		//打开当前页面右边页面
		parent.switchIframeByClick('wode');
	}
	function swipeUp() {
		/* var scrolltop = $(document).scrollTop();
		var docHeight = $(document).height();
		var winHeight = $(window).height();
		if (scrolltop / (docHeight - winHeight) >= 0.9) {//滚动到距底部20%时 */
			/* 正在查看的是工作列表 */
			if ($('a[class*="ui-btn-active"]').attr('href') == "#workDiv") {

				loadWorkList();

			} else {/* 正在查看的是求职列表 */
				loadReqWorkList();
			}
		//}
	}
	function loadWorkList() {
		var workInfo = {};
			workInfo.page = '1';
			workInfo.cityName = localStorage.city;
			workInfo.workType = 'partTime,fullTime';//兼职/全职招聘

			ajaxReq('workAction', {
				method : 'getWorkList',
				workInfo : json2Str(workInfo)
			}, function(data) {
				if (data.flag != 'fail') {
					fillWorkList(data);
				} else {
					alert(data.msg);
				}
			});
	}

	function fillWorkList(data) {
		var newhtml = '<li data-icon="false" onclick="openWork(this)" workId="+workId+"><a href="#" class="ui-btn ui-mini">\
            <div style="overflow: hidden;">\
            <p style="float: left;font-weight:bold;">+title+</p>\
            <p style="color: black; float: right">+time+</p>\
            </div><div style="overflow: hidden;">\
                        <p style="float: left">+condition+</p>\
                        <p style="color: red; float: right">时薪:+daymoney+</p>\
                    </div><div style="overflow: hidden;">\
                        <p style="float: left">+username+</p>\
                        <div style="float: right; color: #f63">+userCredit+\
                        </div></div></a></li>';

		for ( var i = 0; data.length > i; i++) {
			var workObj = data[i];
			var conditionStr = '';
			conditionStr += getDisplayEnumValue('expectDegree',
					workObj.expectDegree)
					+ '学历';
			conditionStr += '&nbsp;|&nbsp;';
			conditionStr += getDisplayEnumValue('expectExperience',
					workObj.expectExperience)
					+ '经验';
			conditionStr += '&nbsp;|&nbsp;';
			conditionStr += getDisplayEnumValue('expectAge', workObj.expectAge)
					+ '年龄';
			
			var userCreditHtml = createCreditHtml(workObj.userCredit);

			var html = newhtml.replace('+username+', workObj.userName)
					.replace('+title+', workObj.workName).replace('+time+',
							workObj.effDate).replace('+condition+',
							conditionStr).replace('+daymoney+',
							workObj.daySallary).replace('+workId+',workObj.workId).replace('+userCredit+',userCreditHtml);

			$('#workList').append(html);
		}

		$('#workList').listview("refresh");
	}
	
	function createCreditHtml(userCredit){
		var strArr = [];
		var mod = userCredit/100;
		mod = parseInt(mod);
		var left =  userCredit%100;
		if (mod>0){
			for (var i=0;mod>i;i++){
				strArr.push('<i class="fa fa-star"></i>');
			}
		}
		if (left>50){
			strArr.push('<i class="fa fa-star-o"></i>');
		}
	    if (strArr.length!=5)
		{
	    	var c = 5-strArr.length;
	    	for (var j=0;c>j;j++)
	    	    strArr.push('<i class="fa fa-star-o"></i>');
		}

	    return strArr.join('');
	}
	function loadReqWorkList() {
		var workInfo = {};
            workInfo.page = '1';
            workInfo.cityName = localStorage.city;
            workInfo.workType = 'reqPartTime,reqFullTime';//兼职求职/全职求职

            ajaxReq('workAction', {
                method : 'getWorkList',
                workInfo : json2Str(workInfo)
            }, function(data) {
                if (data.flag != 'fail') {
                	fillReqWorkList(data);
                } else {
                    alert(data.msg);
                }
            });
	}
	
	function fillReqWorkList(data){
        var newhtml = '<li data-icon="false" onclick="openReqWorkDetail(this)" workId="+workId+"><a\
            href="#" class="ui-btn ui-mini">\
        <div style="overflow: hidden;">\
            <p style="float: left; font-weight: bold;">+workName+</p>\
            <p style="color: black; float: right">+time+</p>\
        </div><p>+basicInfo+</p><p>+condition+</p><p >+req+</p></a></li>';

        for ( var i = 0; data.length > i; i++) {
            var workObj = data[i];
            var basicInfo = '';
            basicInfo +=  workObj.resumeInfo.realName;
            basicInfo += '&nbsp;|&nbsp;';
            basicInfo +=  getDisplayEnumValue('sex',
                    workObj.resumeInfo.sex);
            basicInfo += '&nbsp;|&nbsp;';
            basicInfo += workObj.resumeInfo.age;
            
            var conditionStr = '';
            conditionStr += getDisplayEnumValue('degree',
                    workObj.resumeInfo.degree)
                    + '学历';
            conditionStr += '&nbsp;|&nbsp;';
            conditionStr += getDisplayEnumValue('experience',
                    workObj.resumeInfo.experience)
                    + '年工作经验';
           

            var reqInfo = '';
            reqInfo += '期望日薪:'+workObj.resumeInfo.daySallary;
            reqInfo += '&nbsp;|&nbsp;';
            reqInfo += '期望工作地:'+getDisplayEnumValue('expectWorkArea',workObj.resumeInfo.expectWorkArea);
            
            //'纪云&nbsp;|&nbsp;男&nbsp;|&nbsp;25岁&nbsp;|&nbsp;促销员'
            //'学历：本科&nbsp;|&nbsp;工作经验：3年'
            //'期望日薪:100-200&nbsp;|&nbsp;期望工作地：江宁'
            var html = newhtml.replace('+basicInfo+',basicInfo).replace('+workId+',workObj.workId).replace('+workName+',workObj.workName)
                    .replace('+time+', workObj.createDate).replace('+condition+',conditionStr).replace('+req+',reqInfo );
            $('#reqworkList').append(html);
        }

        $('#reqworkList').listview("refresh");
	}
	function openWork(obj) {
		var workid = $(obj).attr('workId');
		changeSubPage('workDetail', 'homePage', 'workid=' + workid);
	}

	function openReqWorkDetail(obj){
	    var workId = $(obj).attr('workId');
	    changeSubPage('reqWorkDetail', 'homePage', 'workId=' + workId);
	}
</script>

</head>
<style type="text/css">
</style>

</head>
<body>
	<div data-role="page" id="homePage" style="top: -20px;">
		<div data-role="header" data-position="fixed" data-fullscreen="false"
			data-tap-toggle="false" id="homeHeader">
			<div
				style="float: left; width: 25%; overflow: hidden; text-align: center; line-height: 49px;">
				<a href="#" data-role="none" data-ajax="false"><!-- onclick="changeSubPage('changeCity','homePage')" -->
				<i class="fa fa-street-view"></i><span id="location">城市</span></a>
			</div>
			<div style="float: left; width: 60%;">
				<input type="search" name="keyboard" placeholder="关键字.."
					style="width: 100%;" id="searchBox" />
			</div>
			<div
				style="float: right; width: 15%; overflow: hidden; text-align: center; line-height: 49px;">
				<a href="#" data-role="none" data-ajax="false"
					onclick="parent.switchIframeByClick('message')"><i
					class="fa fa-envelope-o"></i><span id="msgCnt">28</span></a>
			</div>
		</div>
		<div class="main_visual">
			<div class="flicking_con">
				<a href="#">1</a> <a href="#">2</a> <a href="#">3</a> <a href="#">4</a>
				<a href="#">5</a>
			</div>
			<div class="main_image">
				<ul>
					<li><img
						src="http://www.internetke.com/jsEffects/2015010801/images/img_main_1.jpg"></li>
					<li><img
						src="http://www.internetke.com/jsEffects/2015010801/images/img_main_1.jpg"></li>
					<li><img
						src="http://www.internetke.com/jsEffects/2015010801/images/img_main_1.jpg"></li>
					<li><img
						src="http://www.internetke.com/jsEffects/2015010801/images/img_main_1.jpg"></li>
					<li><img
						src="http://www.internetke.com/jsEffects/2015010801/images/img_main_1.jpg"></li>
				</ul>
				<a href="javascript:;" id="btn_prev" style="display: none;"></a> <a
					href="javascript:;" id="btn_next" style="display: none;"></a>
			</div>
		</div>

		<div class="h1"></div>
		<p style="margin: 5px 5px; text-align: center; font-weight: bold"
			id="yourLike">今日精选</p>
		<div class="ui-grid-a">
			<div class="ui-block-a" style="text-align: center;" id="foodDiv">
				<a class="ui-bar ui-bar-a">
					<p style="margin: 0px">关注最多企业</p>
				</a>
			</div>
			<div class="ui-block-b" style="text-align: center;" id="workDiv">
				<a class="ui-bar ui-bar-a">
					<p style="margin: 0px">评价最好企业</p>
				</a>
			</div>
		</div>
		<div class="ui-grid-a">
			<div class="ui-block-a" style="text-align: center;"
				id="entertainmentDiv">
				<a class="ui-bar ui-bar-a">
					<p style="margin: 0px">关注最多招聘</p>
				</a>
			</div>
			<div class="ui-block-b" style="text-align: center;"
				id="entertainmentDiv">
				<a class="ui-bar ui-bar-a">
					<p style="margin: 0px">简历最多招聘</p>
				</a>
			</div>
		</div>
		<div class="h1"></div>
		<p style="margin: 5px 5px; text-align: center; font-weight: bold"
			id="yourLike">热门企业</p>
		<div class="ui-grid-a">
			<div class="ui-block-a" style="text-align: center;" id="foodDiv">
				<a class="ui-bar ui-bar-a">
					<p style="margin: 0px">关注最多</p>
				</a>
			</div>
			<div class="ui-block-b" style="text-align: center;" id="workDiv">
				<a class="ui-bar ui-bar-a">
					<p style="margin: 0px">评价最好</p>
				</a>
			</div>
		</div>
		<div class="h1"></div>
		<p style="margin: 5px 5px; text-align: center; font-weight: bold"
			id="yourLike">猜你喜欢</p>
		<div id="tabs" data-role="tabs">
			<div data-role="navbar">
				<ul>
					<li><a href="#workDiv" class="ui-btn-active">招聘</a></li>
					<li><a href="#reqWorkDiv" onclick="loadReqWorkList()">求职</a></li>
				</ul>
			</div>

			<div id="workDiv">
				<ul data-role="listview" id="workList">
					<li data-icon="false" onclick="openWork(this)" workId="1"><a
						href="#" class="ui-btn ui-mini">
							<div style="overflow: hidden;">
								<p style="float: left; font-weight: bold;">招聘营业员(江宁)</p>
								<!--招聘标题-->
								<p style="color: black; float: right">22:23 PM</p>
							</div>
							<div style="overflow: hidden;">
								<p style="float: left">学历不限&nbsp;|&nbsp;经验不限&nbsp;|&nbsp;年龄不限</p>
								<!--要求-->
								<p style="color: red; float: right">日薪:100-200</p>
								<!--待遇-->
							</div>
							<div style="overflow: hidden;">
								<p style="float: left">KFC-欧尚超市店</p>
								<!--招聘用户名称-->
								<p style="float: right; color: #f63">
									<i class="fa fa-star"></i><i class="fa fa-star"></i><i
										class="fa fa-star"></i><i class="fa fa-star"></i><i
										class="fa fa-star-half-full"></i>
								</p>
							</div>
					</a></li>
					<li data-icon="false" onclick="openWork(this)" workId="1"><a
						href="#" class="ui-btn ui-mini">
							<div style="overflow: hidden;">
								<p style="float: left; font-weight: bold;">招聘营业员(江宁)</p>
								<!--招聘标题-->
								<p style="color: black; float: right">22:23 PM</p>
							</div>
							<div style="overflow: hidden;">
								<p style="float: left">学历不限&nbsp;|&nbsp;经验不限&nbsp;|&nbsp;年龄不限</p>
								<!--要求-->
								<p style="color: red; float: right">日薪:100-200</p>
								<!--待遇-->
							</div>
							<div style="overflow: hidden;">
								<p style="float: left">KFC-欧尚超市店</p>
								<!--招聘用户名称-->
								<p style="float: right; color: #f63">
									<i class="fa fa-star"></i><i class="fa fa-star"></i><i
										class="fa fa-star"></i><i class="fa fa-star"></i><i
										class="fa fa-star-half-full"></i>
								</p>
							</div>
					</a></li>
					<li data-icon="false" onclick="openWork(this)" workId="1"><a
						href="#" class="ui-btn ui-mini">
							<div style="overflow: hidden;">
								<p style="float: left; font-weight: bold;">招聘营业员(江宁)</p>
								<!--招聘标题-->
								<p style="color: black; float: right">22:23 PM</p>
							</div>
							<div style="overflow: hidden;">
								<p style="float: left">学历不限&nbsp;|&nbsp;经验不限&nbsp;|&nbsp;年龄不限</p>
								<!--要求-->
								<p style="color: red; float: right">日薪:100-200</p>
								<!--待遇-->
							</div>
							<div style="overflow: hidden;">
								<p style="float: left">KFC-欧尚超市店</p>
								<!--招聘用户名称-->
								<p style="float: right; color: #f63">
									<i class="fa fa-star"></i><i class="fa fa-star"></i><i
										class="fa fa-star"></i><i class="fa fa-star"></i><i
										class="fa fa-star-half-full"></i>
								</p>
							</div>
					</a></li>
					<li data-icon="false" onclick="openWork(this)" workId="1"><a
						href="#" class="ui-btn ui-mini">
							<div style="overflow: hidden;">
								<p style="float: left; font-weight: bold;">招聘营业员(江宁)</p>
								<!--招聘标题-->
								<p style="color: black; float: right">22:23 PM</p>
							</div>
							<div style="overflow: hidden;">
								<p style="float: left">学历不限&nbsp;|&nbsp;经验不限&nbsp;|&nbsp;年龄不限</p>
								<!--要求-->
								<p style="color: red; float: right">日薪:100-200</p>
								<!--待遇-->
							</div>
							<div style="overflow: hidden;">
								<p style="float: left">KFC-欧尚超市店</p>
								<!--招聘用户名称-->
								<p style="float: right; color: #f63">
									<i class="fa fa-star"></i><i class="fa fa-star"></i><i
										class="fa fa-star"></i><i class="fa fa-star"></i><i
										class="fa fa-star-half-full"></i>
								</p>
							</div>
					</a></li>
					<li data-icon="false" onclick="openWork(this)" workId="1"><a
						href="#" class="ui-btn ui-mini">
							<div style="overflow: hidden;">
								<p style="float: left; font-weight: bold;">招聘营业员(江宁)</p>
								<!--招聘标题-->
								<p style="color: black; float: right">22:23 PM</p>
							</div>
							<div style="overflow: hidden;">
								<p style="float: left">学历不限&nbsp;|&nbsp;经验不限&nbsp;|&nbsp;年龄不限</p>
								<!--要求-->
								<p style="color: red; float: right">日薪:100-200</p>
								<!--待遇-->
							</div>
							<div style="overflow: hidden;">
								<p style="float: left">KFC-欧尚超市店</p>
								<!--招聘用户名称-->
								<p style="float: right; color: #f63">
									<i class="fa fa-star"></i><i class="fa fa-star"></i><i
										class="fa fa-star"></i><i class="fa fa-star"></i><i
										class="fa fa-star-half-full"></i>
								</p>
							</div>
					</a></li>
				</ul>

			</div>
			<div id="reqWorkDiv">
				<ul data-role="listview" id="reqworkList">
					<li data-icon="false" onclick="openResume(this)" resumeId="1"><a
						href="#" class="ui-btn ui-mini">
							<div style="overflow: hidden;">
								<p style="float: left; font-weight: bold;">纪云&nbsp;|&nbsp;男&nbsp;|&nbsp;25岁&nbsp;|&nbsp;促销员</p>
								<p style="color: black; float: right">22:23 PM</p>
							</div>
							<p>学历：本科&nbsp;|&nbsp;工作经验：3年</p>
							<p>期望日薪:100-200&nbsp;|&nbsp;期望工作地：江宁</p>
					</a></li>
					<li data-icon="false" onclick="openResume(this)" resumeId="1"><a
						href="#" class="ui-btn ui-mini">
							<div style="overflow: hidden;">
								<p style="float: left; font-weight: bold;">纪云&nbsp;|&nbsp;男&nbsp;|&nbsp;25岁&nbsp;|&nbsp;促销员</p>
								<p style="color: black; float: right">22:23 PM</p>
							</div>
							<p>学历：本科&nbsp;|&nbsp;工作经验：3年</p>
							<p>期望日薪:100-200&nbsp;|&nbsp;期望工作地：江宁</p>
					</a></li>
					<li data-icon="false" onclick="openResume(this)" resumeId="1"><a
						href="#" class="ui-btn ui-mini">
							<div style="overflow: hidden;">
								<p style="float: left; font-weight: bold;">纪云&nbsp;|&nbsp;男&nbsp;|&nbsp;25岁&nbsp;|&nbsp;促销员</p>
								<p style="color: black; float: right">22:23 PM</p>
							</div>
							<p>学历：本科&nbsp;|&nbsp;工作经验：3年</p>
							<p>期望日薪:100-200&nbsp;|&nbsp;期望工作地：江宁</p>
					</a></li>
					<li data-icon="false" onclick="openResume(this)" resumeId="1"><a
						href="#" class="ui-btn ui-mini">
							<div style="overflow: hidden;">
								<p style="float: left; font-weight: bold;">纪云&nbsp;|&nbsp;男&nbsp;|&nbsp;25岁&nbsp;|&nbsp;促销员</p>
								<p style="color: black; float: right">22:23 PM</p>
							</div>
							<p>学历：本科&nbsp;|&nbsp;工作经验：3年</p>
							<p>期望日薪:100-200&nbsp;|&nbsp;期望工作地：江宁</p>
					</a></li>
					<li data-icon="false" onclick="openResume(this)" resumeId="1"><a
						href="#" class="ui-btn ui-mini">
							<div style="overflow: hidden;">
								<p style="float: left; font-weight: bold;">纪云&nbsp;|&nbsp;男&nbsp;|&nbsp;25岁&nbsp;|&nbsp;促销员</p>
								<p style="color: black; float: right">22:23 PM</p>
							</div>
							<p>学历：本科&nbsp;|&nbsp;工作经验：3年</p>
							<p>期望日薪:100-200&nbsp;|&nbsp;期望工作地：江宁</p>
					</a></li>
				</ul>
			</div>
		</div>
		<!-- 显示返回到页面顶端浮动按钮-->
		<div class="location">
			<a href="#"
				class="ui-btn ui-shadow ui-corner-all ui-icon-carat-u ui-btn-icon-notext ui-btn-b ui-btn-inline"></a>
		</div>
	</div>
</body>
</html>