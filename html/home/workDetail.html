<!DOCTYPE html>
<html manifest="../pinba.appcache">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width" />

<link rel="stylesheet" href="../css/jquery.mobile-1.4.5.css" />
<link rel="stylesheet" href="../mycss/photoswipe.css" />
<link rel="stylesheet" href="../css/font-awesome.css" />
<link rel="stylesheet" href="../mycss/mygrid.css" />
<script src="../js/jquery-1.11.3.js"></script>
<script src="../js/jquery.mobile-1.4.5.js"></script>
<!-- 支持jquery.event.drag-1.5.min.js中的图片手动滑动 -->
<script type="text/javascript" src="../myjs/mycommon.js"></script>
<script type="text/javascript" src="../myjs/myswipe.js"></script>
<script type="text/javascript">
	function swipeRight() {
		closeSubPage();
	}
	var workId = 0;
	var userId = 0;
	$(document).ready(function() {
		//为关注钮增加响应事件
	   $('#addFocusBtn').bind('click',function() {
											var cachedUserInfo = getLoginUserInfo();
											if (cachedUserInfo != null) {
												var focusInfo = {};
												focusInfo.userToken = cachedUserInfo.userToken;
												focusInfo.userId = cachedUserInfo.userId;
												focusInfo.workId = workId;

												ajaxReq(
														'workAction',
														{
															method : 'addFocus',
															focusInfo : json2Str(focusInfo)
														},
														function(data) {
															if (data.flag == 'success') {
																$(
																		'#addFocusBtn')
																		.html(
																				data.focusNumber);
															} else {
																alert(data.msg);
															}
														});
											}
										});
						//为投简历按钮增加响应事件
						$('#sendResumeBtn')
								.bind(
										'click',
										function() {
											//列出用户已有的简历
											$('#resumeList').html('');
											var resumeInfo = {};
											var cachedUserInfo = getLoginUserInfo();
											if (cachedUserInfo != null) {
												resumeInfo.userId = cachedUserInfo.userId;
												resumeInfo.userToken = cachedUserInfo.userToken;
												resumeInfo.page = '1';

												ajaxReq(
														'resumeAction',
														{
															method : 'getResumeList',
															resumeInfo : json2Str(resumeInfo)
														},
														function(data) {
															if (data.flag != 'fail') {
																if (data.length == 0) {
																	alert("你还没有简历，需要先增加一上简历!");
																	changeSubPage(
																			'resume',
																			'workdetailPage');
																} else {
																	var lihtmls = '<li data-role="list-divider">选择一个简历</li>';

																	for ( var i = 0; data.length > i; i++) {
																		var resumeobj = data[i];
																		var lihtml = '<li><a onclick="sendResume(this)" resumeId="'
																				+ resumeobj.resumeId
																				+ '">'
																				+ resumeobj.resumeName
																				+ '</a></li>';
																		lihtmls += lihtml;
																	}
																	$(
																			'#resumeList')
																			.append(
																					lihtmls);
																	$(
																			'#resumeList')
																			.listview(
																					"refresh");

																	//打开简历选择框
																	$(
																			'#popupMenu')
																			.popup();
																	$(
																			'#popupMenu')
																			.popup(
																					'open');
																}

															} else {
																alert(data.msg);
															}
														});
											}
										});

						workId = getQueryString('workId');
						if (workId > 0) {
							$('#title').html('修改工作');
							pageInit();
						}
					});
	function sendResume(obj) {
		var resumeId = $(obj).attr('resumeId');
		var cachedUserInfo = getLoginUserInfo();
		if (cachedUserInfo != null) {
			var sendResumeInfo = {};
			sendResumeInfo.userToken = cachedUserInfo.userToken;
			sendResumeInfo.resumeId = resumeId;
			sendResumeInfo.workId = workId;

			ajaxReq('resumeAction', {
				method : 'sendResume',
				sendResumeInfo : json2Str(sendResumeInfo)
			}, function(data) {
				if (data.flag == 'success') {
					alert(data.msg);

					$('#popupMenu').popup("close");
				} else {
					alert(data.msg);
				}
			});
		}
	}
	function pageInit() {
		var workInfo = {};
		if (workId > 0) {
			workInfo.workId = workId;
		}
		var cachedUserInfo = str2Json(localStorage.userInfo);
		if (cachedUserInfo != null) {
			workInfo.userToken = cachedUserInfo.userToken;
			workInfo.readUserId = cachedUserInfo.userId;
			userId =  cachedUserInfo.userId;
		}else{
			userId = 0;
		}
			ajaxReq('workAction', {
				method : 'getWorkInfo',
				workInfo : json2Str(workInfo)
			}, function(data) {
				if (data.flag == 'success') {
					bindData(data, 'workDetailDiv');
					$('#addFocusBtn').html(data.focusNumber);
					//如果不是工作所有者，需要删除修改按钮
					var workOwnerId = data.userId;
					if (userId == workOwnerId) {
						$('#footer').remove();
					} else {
						$('#modBtn').remove();
					}
				} else {
					alert(data.msg);
				}
			});
		
	}
	//绑定数据到控件
	function bindData(jsonData, divId) {
		for ( var o in jsonData) {
			var ctrl = $('#' + divId + ' #' + o);
			if (ctrl.length > 0) {
				//处理下拉框采集的数据
				var realValue = jsonData[o];
				var displayValue = getDisplayEnumValue(o, realValue);
				ctrl.html(displayValue);
			}
		}
		//绑定企业信息
		if (jsonData.userInfo != null) {
			bindData(jsonData.userInfo, 'companyInfoUL');
		}
	}
	function modWork() {
		changeSubPage('work', 'workdetailPage', 'workId=' + workId);
	}
</script>


<style type="text/css">
</style>

</head>
<body>
	<div data-role="page" id="workdetailPage">
		<!-- <div data-role="header" data-position="fixed" data-fullscreen="false" data-tap-toggle="false"> -->
		<!-- 返回按钮 -->
		<div data-role="header" data-position="fixed" data-fullscreen="false"
			data-tap-toggle="false">
			<a href="#" data-rel="back"
				class="ui-btn ui-btn-left ui-alt-icon ui-nodisc-icon ui-corner-all ui-btn-icon-notext ui-icon-carat-l"
				onclick="closeSubPage();return false;">Back</a>
			<h1>工作详情</h1>
			<a onclick="modWork()" id="modBtn"
				class="ui-btn ui-corner-all ui-shadow ui-btn-icon-left ui-icon-edit">修改工作</a>
		</div>
		<ul data-role="listview" data-inset="true" id="workDetailDiv">
			<li data-role="list-divider" id="workName">基本信息</li>
			<li data-icon="false" style="padding: 0em 1em">
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>人数:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="numberOfRecruit"></p>
					</div>
				</div>
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>区域:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="workArea"></p>
					</div>
				</div>
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>地址:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="address"></p>
					</div>
				</div>
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>职位:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="post"></p>
					</div>
				</div>
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>发布时间:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="createDate"></p>
					</div>
				</div>
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>截止时间:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="expDate"></p>
					</div>
				</div>
			</li>
			<li data-role="list-divider">待遇</li>
			<li data-icon="false" style="padding: 0em 1em">
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>日薪:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="daySallary"></p>
					</div>
				</div>
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>工资当天结算:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="dayCharge"></p>
					</div>
				</div>
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>提供食宿:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="foodAndLodging"></p>
					</div>
				</div>
			</li>
			<li data-role="list-divider">要求</li>
			<li data-icon="false" style="padding: 0em 1em">
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>学历:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="expectDegree"></p>
					</div>
				</div>
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>工作经验:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="expectExperience"></p>
					</div>
				</div>
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>年龄:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="expectAge"></p>
					</div>
				</div>
			</li>
			<li data-role="list-divider">工作内容</li>
			<li data-icon="false" style="padding: 0em 1em">
				<p style="white-space: pre-line;" id="content"></p>
			</li>

		</ul>
		<ul data-role="listview" id="companyInfoUL">
			<li data-role="list-divider">公司信息<span class="ui-li-count"><div
						style="float: right; color: #f63">
						<i class="fa fa-star"></i><i class="fa fa-star"></i><i
							class="fa fa-star"></i><i class="fa fa-star"></i><i
							class="fa fa-star-half-full"></i>
					</div></span></li>
			<li data-icon="false" style="padding: 0em 1em">
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>公司名称:</p>
					</div>
					<div style="float: left; width: 70%">
						<p style="white-space: pre-line;" id="userName"></p>
					</div>
				</div>

				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>公司地址:</p>
					</div>
					<div style="float: left; width: 70%">
						<p style="white-space: pre-line;" id="address"></p>
					</div>
				</div>
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>电话:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="cellphone"></p>
					</div>
				</div>
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>邮箱:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="email"></p>
					</div>
				</div>
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>网址:</p>
					</div>
					<div style="float: left; width: 70%">
						<p id="url"></p>
					</div>
				</div>
				<div style="overflow: hidden">
					<div style="float: left; width: 30%; color: #a3a3a3">
						<p>公司介绍:</p>
					</div>
					<div style="float: left; width: 70%">
						<p style="white-space: pre-line;" id="selfReview"></p>
					</div>
				</div>
			</li>
			<li><a href="#">该公司其它招聘<span class="ui-li-count" id="workNumber">2</span></a></li>
		</ul>

        <!-- 简历选择框 -->
		<div data-role="popup" id="popupMenu">
			<ul data-role="listview" data-inset="true" style="min-width: 210px;"
				id="resumeList">
				<li data-role="list-divider"><h2>
						select...
						<h2></li>
				<li><a href="#">View details</a></li>
				<li><a href="#">Edit</a></li>
				<li><a href="#">Disable</a></li>
				<li><a href="#">Delete</a></li>
			</ul>
		</div>

		<div data-role="footer" data-position="fixed" data-fullscreen="false"
			data-tap-toggle="false" class="ui-bar" id="footer">
			<div data-role="controlgroup" data-type="horizontal">
				<a href="#" id="addFocusBtn" data-role="button" data-icon="plus">10
				</a> <a href="#" id="sendResumeBtn" data-role="button" data-icon="mail">投递简历</a>
			</div>
		</div>
	</div>
</body>
</html>