<!DOCTYPE html>
<html manifest="../pinba.appcache">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width" />
<script src="../js/jquery-1.11.3.js"></script>
<link rel="stylesheet" href="../css/jquery.mobile-1.4.5.css" />
<script src="../js/jquery.mobile-1.4.5.js"></script>
<script type="text/javascript" src="../myjs/mycommon.js"></script>
<script type="text/javascript" src="../myjs/myswipe.js"></script>
<style>
</style>

<script type="text/javascript">
var workId = 0;
var workType = 'reqPartTime';
    $(document).ready(
            function() {
                $('#verifyImg').attr(
                        'src',
                        getContextPath()
                                + '/verifyImage?width=70&height=21&length=4');
              //初始化下拉框控件
                $('select').each(function(index,item){
                    fillOptions(item.id);
                });
                
                workType = getQueryString('workType');
                if (workType==null){
                    workType = 'reqPartTime';
                }
                workId = getQueryString('workId');
                if (workId > 0) {
                    $('#title').html('修改求职');
                    var workInfo = {};
                    if (workId > 0) {
                        workInfo.workId = workId;
                    }
                    var cachedUserInfo = getLoginUserInfo();
                    if (cachedUserInfo != null) {
                        workInfo.userToken = cachedUserInfo.userToken;
                        workInfo.readUserId = cachedUserInfo.userId;
                        ajaxReq('workAction', {
                            method : 'getWorkInfo',
                            workInfo : json2Str(workInfo)
                        }, function(data) {
                            if (data.flag == 'success') {
                                bindData(data);
                            } else {
                                alert(data.msg);
                                return false;
                            }
                        });
                    }
                }
            });
    function swipeRight() {
        closeSubPage();
    }
    //绑定数据到控件
    function bindData(jsonData) {
        for ( var o in jsonData) {
            var value = jsonData[o];
            var ctrl = $('#' + o);
            if (ctrl.length > 0) {
            	if (ctrl[0].tagName=='SELECT'){//jquery mobile 渲染了select,html完全变了
                    selectOptions(o,value); 
                }if (o=='selfreview'){
                    ctrl.html(value);
                }else{
                    ctrl.val(value);
                }
            }
        }
    }
    function publish() {
        var workInfo = {};
        var method = 'newWork';
        if (workId > 0) {
            workInfo.workId = workId;
            method = 'modWork';
        }
        var cachedUserInfo = getLoginUserInfo();
        if (cachedUserInfo != null) {
            workInfo.userId = cachedUserInfo.userId;
            workInfo.workName = $('#workName').val();
            workInfo.content = $('#content').val();
            workInfo.workType = workType;
            workInfo.expDate = $('#expDate').val();
            workInfo.effDate = $('#effDate').val();
            workInfo.resumeId = $('#resumeId').val();
            workInfo.verifyCode = $('#verifyCode').val();

            ajaxReq('workAction', {
                method : method,
                workInfo : json2Str(workInfo)
            }, function(data) {
                if (data.flag == 'success') {
                    alert(data.msg);
                    closeSubPage();
                } else {
                    alert(data.msg);
                    return false;
                }
            });
        }
        return false;
    }
    
    function pub(){
        $('#pubBtn').click();
    }
</script>
</head>
<body>
    <div id="workPage" data-role="page">
        <div data-role="header" id="header">

            <a href="#" data-rel="back"
                class="ui-btn ui-btn-left ui-alt-icon ui-nodisc-icon ui-corner-all ui-btn-icon-notext ui-icon-carat-l"
                onclick="closeSubPage();return false;">Back</a>
            <h1 id="title">发布求职</h1>

        </div>
        <div data-role="content" class="ui-mini">
            <form method="post" action="" onsubmit="return publish()">
                <div data-role="fieldcontain">
                    <label for="workName">标题:</label> <input type="text"
                        name="workName" id="workName" value="" required="required"
                        placeholder="工作简介">
                </div>
                <div data-role="fieldcontain">
                    <label for="content">工作内容:</label>
                    <textarea cols="40" rows="8" name="content" id="content"
                        data-mini="true" required="required" placeholder="工作详细内容">工作内容</textarea>
                </div>


                <div data-role="fieldcontain">
                    <label for="resumeId" class="select">求职简历:</label> <select
                        name="resumeId" id="resumeId" data-native-menu="false">
                        <option value="41" selected>酒店临时工简历</option>
                        <option value="41">服务员简历</option>
                        <option value="41">派单员</option>
                    </select>
                </div>

                <div data-role="fieldcontain">
                    <label for="effDate">生效时间:</label> <input type="date"
                        name="effDate" id="effDate" value="" required="required">
                </div>
                <div data-role="fieldcontain">
                    <label for="expDate">失效时间:</label> <input type="date"
                        name="expDate" id="expDate" value="" required="required">
                </div>
                <div data-role="fieldcontain">
                    <label for="verifyCode">验证码:</label>
                    <div style="display: inline-flex; width: 100%">
                        <div style="width: 70%; height: 100%;">
                            <input type="text" name="verifyCode" id="verifyCode" value=""
                                placeholder="验证码" required="required">
                        </div>
                        <a data-mini="true" href="#"
                            style="width: 30%; height: 100%; margin-top: 8px;"><img
                            src="" id="verifyImg"></img></a>
                    </div>
                </div>
                <button type="submit" class="ui-btn" onclick="" style="display:none" id="pubBtn">发布</button>
            </form>
        </div>
        <div data-role="footer" data-position="fixed" data-fullscreen="false"
            data-tap-toggle="false">
            <a data-role="button" class="ui-btn ui-corner-all" style="width:100%;color:red"  onclick="pub()">发布</a>
        </div>
    </div>
</body>
</html>