<!DOCTYPE html>
<html manifest="../pinba.appcache">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width" />
<script src="../js/jquery-1.11.3.js"></script>
<link rel="stylesheet" href="../css/jquery.mobile-1.4.5.css" />
<script src="../js/jquery.mobile-1.4.5.js"></script>
<script type="text/javascript" src="../myjs/mycommon.js"></script>
<script type="text/javascript" src="../myjs/myswipe.js"></script>
<style>
</style>

<script type="text/javascript">
	var workId = 0;
	var workType = 'partTime';
	$(document).ready(
			function() {
				$('#verifyImg').attr(
						'src',
						getContextPath()
								+ '/verifyImage?width=70&height=21&length=4');
				
				//初始化下拉框控件
				$('select').each(function(index,item){
					fillOptions(item.id);
				});
				workType = getQueryString('workType');
				if (workType == null) {
					workType = 'partTime';
				}
				workId = getQueryString('workId');
				if (workId > 0) {
					$('#title').html('修改工作');
					var workInfo = {};
					if (workId > 0) {
						workInfo.workId = workId;
					}
					var cachedUserInfo = str2Json(localStorage.userInfo);
					if (cachedUserInfo != null) {
						workInfo.userToken = cachedUserInfo.userToken;

						ajaxReq('workAction', {
							method : 'getWorkInfo',
							workInfo : json2Str(workInfo)
						}, function(data) {
							if (data.flag == 'success') {
								bindData(data);
							} else {
								alert(data.msg);
								return false;
							}
						});
					}
				}
			});
	function swipeRight() {
		closeSubPage();
	}
	//绑定数据到控件
	function bindData(jsonData) {
		for ( var o in jsonData) {
			var value = jsonData[o];
			var ctrl = $('#' + o);
			if (ctrl.length > 0) {
				if (ctrl[0].tagName=='SELECT'){//jquery mobile 渲染了select,html完全变了
                    selectOptions(o,value); 
                }if (o == 'selfreview') {
					ctrl.html(value);
				} else {
					ctrl.val(value);
				}
			}
		}
	}
	function publish() {
		var workInfo = {};
		var method = 'newWork';
		if (workId > 0) {
			workInfo.workId = workId;
			method = 'modWork';
		}
		var cachedUserInfo = str2Json(localStorage.userInfo);
		if (cachedUserInfo != null) {
			workInfo.userId = cachedUserInfo.userId;
			workInfo.workName = $('#workName').val();
			workInfo.content = $('#content').val();
			workInfo.numberOfRecruit = $('#numberOfRecruit').val();
			workInfo.workType = workType;
			workInfo.workArea = $('#workArea').val();
			workInfo.post = $('#post').val();
			workInfo.address = $('#address').val();
			workInfo.daySallary = $('#daySallary').val();
			workInfo.dayCharge = $('#dayCharge').val();
			workInfo.foodAndLodging = $('#foodAndLodging').val();
			workInfo.expectDegree = $('#expectDegree').val();
			workInfo.expectExperience = $('#expectExperience').val();
			workInfo.expectAge = $('#expectAge').val();
			workInfo.expDate = $('#expDate').val();
			workInfo.effDate = $('#effDate').val();
			workInfo.verifyCode = $('#verifyCode').val();

			ajaxReq('workAction', {
				method : method,
				workInfo : json2Str(workInfo)
			}, function(data) {
				if (data.flag == 'success') {
					alert(data.msg);
					closeSubPage();
				} else {
					alert(data.msg);
					return false;
				}
			});
		}
		return false;
	}

	function pub() {
		$('#pubBtn').click();
	}
</script>
</head>
<body>
	<div id="workPage" data-role="page">
		<div data-role="header" id="header">

			<a href="#" data-rel="back"
				class="ui-btn ui-btn-left ui-alt-icon ui-nodisc-icon ui-corner-all ui-btn-icon-notext ui-icon-carat-l"
				onclick="closeSubPage();return false;">Back</a>
			<h1 id="title">发布工作</h1>

		</div>
		<div data-role="content" class="ui-mini">
			<form method="post" action="" onsubmit="return publish()">
				<div data-role="fieldcontain">
					<label for="workName">标题:</label> <input type="text"
						name="workName" id="workName" value="" required="required"
						placeholder="工作简介">
				</div>
				<div data-role="fieldcontain">
					<label for="content">工作内容:</label>
					<textarea cols="40" rows="8" name="content" id="content"
						data-mini="true" required="required" placeholder="工作详细内容">工作内容</textarea>
				</div>
				<div data-role="fieldcontain">
					<label for="numberOfRecruit">人数:</label> <input type="text"
						name="numberOfRecruit" id="numberOfRecruit" value=""
						required="required" placeholder="招聘人数" pattern="[0-9]{1,3}"
						title="必须是整数">
				</div>

				<div data-role="fieldcontain">
					<label for="post" class="select">职位:</label> <select name="post"
						id="post" data-native-menu="false">
						<option value="xuesheng" selected>学生兼职</option>
						<option value="xiaoshigong">小时工</option>
						<option value="shixisheng">实习生</option>
						<option value="chuxiao">促销</option>
						<option value="jiajiao">家教</option>
						<option value="chuangdan">传单派发</option>
						<option value="mote">模特</option>
					</select>
				</div>


				<div data-role="fieldcontain">
					<label for="workArea" class="select">区域:</label> <select
						name="workArea" id="workArea" data-native-menu="false"
						required="required">
						<option value="njgulou" selected>鼓楼</option>
						<option value="njqinhuai">秦淮</option>
						<option value="njbaixia">白下</option>
						<option value="njqixia">栖霞</option>
						<option value="njjianye">建邺</option>
						<option value="njyuhua">雨花</option>
						<option value="njjiangning">江宁</option>
						<option value="njpukou">浦口</option>
						<option value="njdachang">大厂</option>
						<option value="njliuhe">六合</option>
						<option value="njgaochun">高淳</option>
						<option value="njlishui">溧水</option>
					</select>
				</div>
				<div data-role="fieldcontain">
					<label for="address">详细地址:</label> <input type="text"
						name="address" id="address" value="" required="required">
				</div>


				<div data-role="fieldcontain">
					<label for="expectDegree" class="select">学历要求:</label> <select
						name="expectDegree" id="expectDegree" data-native-menu="false">
						<option value="gaozhong" selected>高中</option>
						<option value="bengke">本科</option>
						<option value="suoshi">硕士</option>
					</select>
				</div>

				<div data-role="fieldcontain">
					<label for="expectExperience" class="select">工作经验要求:</label> <select
						name="expectExperience" id="expectExperience"
						data-native-menu="false">
						<option value="1-3" selected>1-3年</option>
						<option value="4-6">4-6</option>
						<option value="6plus">6年以上</option>
					</select>
				</div>
				<div data-role="fieldcontain">
					<label for="expectAge" class="select">年龄要求:</label> <select
						name="expectAge" id="expectAge" data-native-menu="false">
						<option value="18-30" selected>18-30</option>
						<option value="31-40">31-40</option>
						<option value="nolimit">不限</option>
					</select>
				</div>

				<div data-role="fieldcontain">
					<label for="daySallary">日薪:</label><input type="range"
						name="daySallary" id="daySallary" value="100" min="0" max="1000">
				</div>
				<div data-role="fieldcontain">
					<label for="dayCharge">工资当天结算:</label> <select name="dayCharge"
						id="dayCharge" data-native-menu="false" data-mini="true">
						<option value="no">No</option>
						<option value="yes" selected="">Yes</option>
					</select>
				</div>

				<div data-role="fieldcontain">
					<label for="foodAndLodging">提供食宿:</label><select
						name="foodAndLodging" id="foodAndLodging" data-native-menu="false"
						data-mini="true">
						<option value="no">No</option>
						<option value="yes" selected="">Yes</option>
					</select>
				</div>

				<div data-role="fieldcontain">
					<label for="effDate">生效时间:</label> <input type="date"
						name="effDate" id="effDate" value="" required="required"
						placeholder="别人在此时间后才能看到你的求职">
				</div>
				<div data-role="fieldcontain">
					<label for="expDate">失效时间:</label> <input type="date"
						name="expDate" id="expDate" value="" required="required"
						placeholder="别人在此时间后将不再能看不到你的求职">
				</div>
				<div data-role="fieldcontain">
					<label for="verifyCode">验证码:</label>
					<div style="display: inline-flex; width: 100%">
						<div style="width: 70%; height: 100%;">
							<input type="text" name="verifyCode" id="verifyCode" value=""
								placeholder="验证码" required="required">
						</div>
						<a data-mini="true" href="#"
							style="width: 30%; height: 100%; margin-top: 8px;"><img
							src="" id="verifyImg"></img></a>
					</div>
				</div>
				<button type="submit" class="ui-btn" onclick=""
					style="display: none" id="pubBtn">发布</button>
			</form>
		</div>
		<div data-role="footer" data-position="fixed" data-fullscreen="false"
			data-tap-toggle="false">
			<a data-role="button" class="ui-btn ui-corner-all" style="width:100%;color:red"  onclick="pub()">发布</a>
		</div>
	</div>
</body>
</html>